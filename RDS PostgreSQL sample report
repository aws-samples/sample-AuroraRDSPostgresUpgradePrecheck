<!DOCTYPE HTML PUBLIC -//W3C//DTD HTML 4.01 Transitional//EN http://www.w3.org/TR/html4/loose.dtd>
<html>
<link rel=stylesheet href=https://unpkg.com/purecss@0.6.2/build/pure-min.css>
<body style=font-family:Verdana bgcolor=#F8F8F8>
<fieldset>
<table><tr> <td width=20></td> <td>
<h1><font face=verdana color=#0099cc><center><u>PostgreSQL Pre-upgrade Check Report For IUSA</u></center></font></h1></color>
<font face=verdana color=#808080><small>Author: Vivek Singh, Sr. Database Specialist - PostgreSQL, Amazon Web Servies | Version V01</small></font>
</fieldset>
<br>
<br>
<table><tr><td bgcolor=red>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><font face=verdana color=#0099cc><medium>&nbsp;&nbsp;Issue found.&nbsp;&nbsp;&nbsp;&nbsp;</font></td>
<td bgcolor=green>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><font face=verdana color=#0099cc><medium>&nbsp;&nbsp;No issue found.&nbsp;&nbsp;&nbsp;&nbsp;</font></td>
<td bgcolor=orange>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><font face=verdana color=#0099cc><medium>&nbsp;&nbsp;Requires manual analysis.</font></td></tr> </table>
<br>
<font face=verdana color=#ff6600>Pre-upgrade check report for:  </font>
<br>
Postgres Endpoint URL: pg14.cjmh5xirlcl7.us-west-2.rds.amazonaws.com
<br>
Current Postgres version: 14.3
<br>
Target Postgres version: 14.6
<br>
Date of report: 03-28-2023
<br>
<br>
<font face=verdana color=#ff6600>1. Check for target Postgres version: </font>
<br>
<font face=verdana color=green>14.6 is one of the target versions for current version of postgres 14.3. No issue found.</font>
<br>
<br>
<font face=verdana color=#ff6600>2. Check for unsupported DB instance classes: </font>
<br>
<font face=verdana color=green>postgres DB instance class db.r5.12xlarge is supported for target postgres version 14.6. No issue found.</font>
<br>
<br>
<font face=verdana color=#ff6600>3. Check for open prepared transactions: </font>
<br>
<font face=verdana color=green>Prepared transactions that are open on the database might lead to upgrade failure. Be sure to commit or roll back all open prepared transactions before starting an upgrade. No uncommitted prepared transactions found.</font>
<br>
<br>
<font face=verdana color=#ff6600>4. Check for unsupported reg* data types: </font>
<br>
<font face=verdana color=green>The pg_upgrade utility doesn't support upgrading databases that include table columns using the reg* OID-referencing system data types. Remove all uses of reg* data types, except for regclass, regrole, and regtype, before attempting an upgrade. No unsupported reg* data types found.</font>
<br>
<br>
<font face=verdana color=#ff6600>5. Check for logical replication slots: </font>
<br>
<font face=verdana color=green>No logical replication slots found. An upgrade can't occur if your instance has any logical replication slots. Logical replication slots are typically used for AWS Database Migration Service (AMS DMS) migration.</font>
<br>
<br>
<font face=verdana color=#ff6600>6. Check for storage issues: </font>
<br>
<font face=verdana color=orange>Total size of all databases in RDS instance pg14 instance is 30GB. Current FreeStorageSpace is 454GB. Make sure to have 15%-20% free storage to avoid upgrade failures.</font>
<br>
<br>
<font face=verdana color=#ff6600>7. Check for 'Incompatible Parameter' error: </font>
<br>
<font face=verdana color=green>Work_mem is set at default value 4MB. Higher value of work_mem can cause 'Incompatible Parameters' issue and might fail upgrade. No issues found.</font>
<br>
<font face=verdana color=orange>Shared_buffers is 93 GB, 24% of total instance memory. The default value of Shared_buffers for RDS Postgres is set at ~24%. If the value is modified to higher value, please reset it to avoid upgrade failures.</font>
<br>
<br>
<font face=verdana color=#ff6600>8. Check for Unknown data types: </font>
<br>
<font face=verdana color=green>PostgreSQL versions 10 and later don't support unknown data types. UNKNOWN data type causes upgrade failure. No 'UNKNOWN' datatype found.</font>
<br>
<br>
<font face=verdana color=#ff6600>9. Check for Read Replica upgrade failure: </font>
<br>
<font face=verdana color=green>In RDS Postgres, all Read Replicas are upgraded followed up by Source instance, adding up outage. No Read Replica found for RDS instance pg14.</font>
<br>
<br>
<font face=verdana color=#ff6600>10. Check for Postgres extensions: </font>
<br>
<font face=verdana color=red>PostgreSQL engine upgrade doesn't upgrade most PostgreSQL extensions. To <a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.PostgreSQL.html#USER_UpgradeDBInstance.PostgreSQL.ExtensionUpgrades target=_blank>update a Postgres extension</a> after a version upgrade, use the ALTER EXTENSION UPDATE command. 2 user extension found as below. Some extensions may need to be dropped otherwise the upgrade fails.</font>
<table border="1">
  <tr>
    <th align="center">name</th>
    <th align="center">version</th>
  </tr>
  <tr valign="top">
    <td align="left">pg_buffercache</td>
    <td align="left">1.3</td>
  </tr>
  <tr valign="top">
    <td align="left">hstore</td>
    <td align="left">1.8</td>
  </tr>
</table> 
<br>
<br>
<font face=verdana color=#ff6600>11. Check for user access: </font>
<br>
<font face=verdana color=orange>This upgrade is being run by user pgone_user. Please make sure this user has access to all database objects. Below are the roles this user is member of. To make sure this user has access to all db objects, pelase grant all users to pgone_user as: GRANT user_name to pgone_user. If the user running upgrade doesn't have access to all tables, upgrade will fail.</font>
<table border="1">
  <tr>
    <th align="center">rolname</th>
    <th align="center">member_of</th>
  </tr>
  <tr valign="top">
    <td align="left">pgone_user</td>
    <td align="left">{rds_superuser}</td>
  </tr>
</table> 
<br>
<br>
<font face=verdana color=#ff6600>12. Check for sql_identifier data type: </font>
<br>
<font face=verdana color=green>Your installation doesn't contain the 'sql_identifier' data type in user tables and/or indexes. No issue found.</font>
<br>
<br>
<font face=verdana color=#ff6600>13. Check for views dependency: </font>
<br>
<font face=verdana color=orange>Check dependency of views, materialized views or functions on system catalogs. If user view, materialized view or function depends on system catalogs such as pg_stat_activity, upgrade may fail. Please verify all views or materialized views and functions are not depending on system catalogs. Below is the list of all views and materialized views.</font>
<table border="1">
  <tr>
    <th align="center">schema</th>
    <th align="center">name</th>
    <th align="center">type</th>
    <th align="center">owner</th>
  </tr>
  <tr valign="top">
    <td align="left">public</td>
    <td align="left">userivew</td>
    <td align="left">view</td>
    <td align="left">pgone_user</td>
  </tr>
</table> 
<br>
<br>
<font face=verdana color=#ff6600>14. Check for incorrect primary user name: </font>
<br>
<font face=verdana color=green>RDS master user is pgone_user and it doesn't start by 'pg_'. No issue found.</font>
<br>
<br>
<font face=verdana color=#ff6600>15. Check for maintenance task: </font>
<br>
<font face=verdana color=orange>Pending maintenance tasks may increase downtime during upgrade or fail upgrade. Please use below AWS CLI command to find and apply RDS maintenance tasks.</font>
<br>
<font face=Courier New color=#0099cc>aws rds describe-pending-maintenance-actions --resource-identifier arn:aws:rds:us-west-2:AWS_Account_no:db:pg14</font>
<br>
<font face=Courier New color=#0099cc>aws rds apply-pending-maintenance-action --resource-identifier arn:aws:rds:us-west-2:AWS_Account_no:db:pg14 --apply-action system-update --opt-in-type immediate</font>
<br>
<br>
<font face=verdana color=#ff6600>AWS documentations for Aurora/RDS Postgres upgrade: </font>
<br>
<font face=verdana color=#0099cc>&nbsp;&nbsp;&#x2022;&nbsp;&nbsp;<a href=https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/USER_UpgradeDBInstance.PostgreSQL.html target=_blank>Upgrading the PostgreSQL DB engine for Aurora PostgreSQL</a>: AWS user guide discusses about Aurora Postgres cluster minor/major version upgrade steps, and upgrading Postgres extensions.
<br>
<font face=verdana color=#0099cc>&nbsp;&nbsp;&#x2022;&nbsp;&nbsp;<a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.PostgreSQL.html target=_blank>Upgrading the PostgreSQL DB engine for Amazon RDS</a>: AWS user guide discusses about RDS Postgres minor/major version upgrade steps, and upgrading Postgres extensions.
<br>
<font face=verdana color=#0099cc>&nbsp;&nbsp;&#x2022;&nbsp;&nbsp;<a href=https://aws.amazon.com/blogs/database/upgrade-amazon-aurora-postgresql-and-amazon-rds-for-postgresql-version-10/ target=_blank>Upgrading the PostgreSQL DB engine for Amazon RDS</a>: AWS data blog discusses about Aurora and RDS Postgres version 10 EOL.
<br>
<font face=verdana color=#0099cc>&nbsp;&nbsp;&#x2022;&nbsp;&nbsp;<a href=https://aws.amazon.com/blogs/database/best-practices-for-upgrading-amazon-rds-to-major-and-minor-versions-of-postgresql/ target=_blank>Best practices for upgrading Amazon RDS to major and minor versions of PostgreSQL</a>: AWS data blog discusses about RDS Postgres upgrade best practices.
<br>
<br>
<br>
<font face=verdana color=#0099cc><small>Note: While modifying any database configuration, parameters, please consult/review with your DBA/DB expert. Results may vary depending on the workloads and expectations. Also, before applying modifications, learn about them at <a href=https://www.postgresql.org/docs/current/pgstatstatements.html target=_blank>PostgreSQL official docs</a>. Before making any changes in production, its recommended to test those in testing environment thoroughly. If you have any feedback about this tool, please provide it to your AWS representative.<small></font>
<br>
<font face=verdana color=#d3d3d3><small>End of report. Script version V01</small></font>
<br>
<br>
</td></tr></table></body></html>
